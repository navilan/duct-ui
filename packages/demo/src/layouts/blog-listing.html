<!DOCTYPE html>
<html lang="en" data-theme="{{ theme or 'duct' }}">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ page.title }}{% if page.title %} - {% endif %}Duct UI</title>
  <meta name="description" content="{{ page.description }}">
  
  <!-- Styles -->
  <link rel="stylesheet" href="/src/styles/main.css">
</head>

<body>
  <!-- Static content rendered by Nunjucks -->
  <div class="max-w-6xl mx-auto px-4 py-8">
      <!-- Page Header -->
      <header class="mb-12">
        <h1 class="text-5xl font-bold mb-4">{{ page.title }}</h1>
        <p class="text-xl text-base-content/70">{{ page.description }}</p>
      </header>

      <!-- Blog Posts Grid -->
      <div class="grid gap-8">
        {% set postsPerPage = page.postsPerPage or 10 %}
        {% set currentPage = page.currentPage or 1 %}
        {% set allPosts = collections.blog or [] %}
        {% set totalPosts = allPosts | length %}
        {% set totalPages = (totalPosts / postsPerPage) | round(0, 'ceil') %}
        {% set startIndex = (currentPage - 1) * postsPerPage %}
        {% set endIndex = startIndex + postsPerPage %}
        
        <!-- Simple iteration without slice for now -->
        {% set pagePosts = [] %}
        {% for post in allPosts %}
          {% if loop.index0 >= startIndex and loop.index0 < endIndex %}
            {% set _ = pagePosts.push(post) %}
          {% endif %}
        {% endfor %}

        {% for post in pagePosts %}
        <article class="card bg-base-200 shadow-xl hover:shadow-2xl transition-shadow">
          <div class="card-body">
            <!-- Post Header -->
            <header>
              <h2 class="card-title text-2xl mb-2">
                <a href="{{ post.path }}" class="link link-hover">
                  {{ post.meta.title }}
                </a>
              </h2>
              
              <div class="flex flex-wrap gap-4 text-sm text-base-content/60 mb-4">
                {% if post.meta.date %}
                <time datetime="{{ post.meta.date }}">
                  {{ post.meta.date | date("MMMM D, YYYY") }}
                </time>
                {% endif %}
                
                {% if post.meta.author %}
                <span>By {{ post.meta.author }}</span>
                {% endif %}
                
                {% if post.meta.readingTime %}
                <span>{{ post.meta.readingTime }} min read</span>
                {% endif %}
              </div>
            </header>

            <!-- Post Excerpt -->
            <p class="text-base-content/80 mb-4">
              {{ post.meta.description or post.body | excerpt(200) }}
            </p>

            <!-- Tags -->
            {% if post.meta.tags and post.meta.tags.length > 0 %}
            <div class="flex flex-wrap gap-2 mb-4">
              {% for tag in post.meta.tags %}
              <span class="badge badge-outline badge-sm">{{ tag }}</span>
              {% endfor %}
            </div>
            {% endif %}

            <!-- Read More -->
            <div class="card-actions justify-end">
              <a href="{{ post.path }}" class="btn btn-primary btn-sm">
                Read More →
              </a>
            </div>
          </div>
        </article>
        {% endfor %}

        {% if totalPosts == 0 %}
        <div class="text-center py-12">
          <p class="text-xl text-base-content/60">No blog posts found.</p>
        </div>
        {% endif %}
      </div>

      <!-- Pagination -->
      {% if totalPages > 1 %}
      <nav class="flex justify-center mt-12">
        <div class="btn-group">
          {% if currentPage > 1 %}
          <a href="/blog/page/{{ currentPage - 1 }}" class="btn">
            « Previous
          </a>
          {% endif %}

          {% for pageNum in range(1, totalPages + 1) %}
            {% if pageNum == currentPage %}
            <button class="btn btn-active">{{ pageNum }}</button>
            {% else %}
            <a href="/blog{% if pageNum > 1 %}/page/{{ pageNum }}{% endif %}" class="btn">
              {{ pageNum }}
            </a>
            {% endif %}
          {% endfor %}

          {% if currentPage < totalPages %}
          <a href="/blog/page/{{ currentPage + 1 }}" class="btn">
            Next »
          </a>
          {% endif %}
        </div>
      </nav>
      {% endif %}

      <!-- Blog Stats -->
      <footer class="mt-12 pt-8 border-t border-base-300">
        <div class="text-center text-sm text-base-content/60">
          {% set actualEnd = endIndex %}
          {% if actualEnd > totalPosts %}
            {% set actualEnd = totalPosts %}
          {% endif %}
          Showing posts {{ startIndex + 1 }}-{{ actualEnd }} of {{ totalPosts }} total posts
        </div>
      </footer>
    </div>
  </div>
  
  <!-- Interactive content container for Duct components (empty initially) -->
  <div id="app"></div>

  <!-- Scripts -->
  {% for script in page.scripts %}
  <script type="module" src="{{ script }}"></script>
  {% endfor %}
  
  {% if page.inlineScript %}
  <script>{{ page.inlineScript | safe }}</script>
  {% endif %}
</body>

</html>