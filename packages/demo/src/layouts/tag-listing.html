{% from "_macros.html" import listing %}
<!DOCTYPE html>
<html lang="en" data-theme="{{ theme or 'duct' }}">

<head>
  {% include "_meta_tags.html" %}
  <link rel="stylesheet" href="/src/styles/main.css">
</head>

<body class="min-h-screen flex flex-col">
  {% include "_header.html" %}

  <!-- Static content rendered by Nunjucks -->
  <div class="max-w-6xl mx-auto px-4 py-8 flex-1">
    {# Filter posts by tag #}
    {% set targetTag = page.tag %}
    {% set filteredPosts = [] %}
    {% for post in collections.blog %}
      {% if post.meta.tags and targetTag in post.meta.tags %}
        {% set _ = filteredPosts.push(post) %}
      {% endif %}
    {% endfor %}

    {# Set up breadcrumbs #}
    {% set breadcrumbs = [
      {url: '/', text: 'Home'},
      {url: '/blog', text: 'Blog'},
      {text: 'Tag: ' + (page.tag or 'Unknown')}
    ] %}

    {# Custom page data for macro #}
    {% set tagPage = {
      title: 'Posts tagged "' + (page.tag or 'Unknown') + '"',
      description: page.description,
      postsPerPage: page.postsPerPage,
      currentPage: page.currentPage
    } %}

    {{ listing(
      filteredPosts, 
      tagPage, 
      '/blog/tag/' + (page.tagSlug or 'unknown'),
      breadcrumbs,
      'No blog posts found with the tag "' + (page.tag or 'Unknown') + '".'
    ) }}
  </div>

  <!-- Interactive content container for Duct components (empty initially) -->
  <div id="app"></div>

  <!-- Scripts -->
  {% for script in page.scripts %}
  <script type="module" src="{{ script }}"></script>
  {% endfor %}

  {% if page.inlineScript %}
  <script>{{ page.inlineScript | safe }}</script>
  {% endif %}
</body>

</html>